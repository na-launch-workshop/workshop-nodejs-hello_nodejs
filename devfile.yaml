schemaVersion: 2.2.2
metadata:
  name: workshop-nodejs-hello_nodejs
  version: 1.0.0
  description: DevSpaces workspace for Node.js hello world translations app
attributes:
  che-editor: vscode
components:
  - name: node22-tools
    container:
      image: docker.io/library/node:22
      command:
        - sh
      args:
        - -c
        - mkdir -p /tmp/.npm && while sleep 3600; do :; done
      env:
        - name: NPM_CONFIG_CACHE
          value: /tmp/.npm
      endpoints:
        - exposure: public
          name: node22-app
          protocol: https
          targetPort: 8080
          path: /
      cpuLimit: '4'
      cpuRequest: '1'
      memoryLimit: '8G'
      memoryRequest: '4G'
      mountSources: true
  - name: node24-tools
    container:
      image: docker.io/library/node:24
      command:
        - sh
      args:
        - -c
        - mkdir -p /tmp/.npm && while sleep 3600; do :; done
      env:
        - name: NPM_CONFIG_CACHE
          value: /tmp/.npm
      endpoints:
        - exposure: public
          name: node24-app
          protocol: https
          targetPort: 8081
          path: /
      cpuLimit: '4'
      cpuRequest: '1'
      memoryLimit: '8G'
      memoryRequest: '4G'
      mountSources: true
commands:
  - id: node22-install
    exec:
      label: "1. Install dependencies (Node 22)"
      component: node22-tools
      workingDir: ${PROJECT_SOURCE}
      commandLine: "npm install"
      group:
        kind: build
        isDefault: true
  - id: node22-test
    exec:
      label: "2. Run tests (Node 22)"
      component: node22-tools
      workingDir: ${PROJECT_SOURCE}
      commandLine: "npm test"
      group:
        kind: test
        isDefault: true
  - id: node22-start
    exec:
      label: "3. Start development server (Node 22)"
      component: node22-tools
      workingDir: ${PROJECT_SOURCE}
      commandLine: "npm start"
      group:
        kind: run
        isDefault: true
  - id: node24-install
    exec:
      label: "1b. Install dependencies (Node 24)"
      component: node24-tools
      workingDir: ${PROJECT_SOURCE}
      commandLine: "npm install"
      group:
        kind: build
        isDefault: false
  - id: node24-test
    exec:
      label: "2b. Run tests (Node 24)"
      component: node24-tools
      workingDir: ${PROJECT_SOURCE}
      commandLine: "npm test"
      group:
        kind: test
        isDefault: false
  - id: node24-start
    exec:
      label: "3b. Start development server (Node 24)"
      component: node24-tools
      workingDir: ${PROJECT_SOURCE}
      commandLine: "npm start"
      group:
        kind: run
        isDefault: false